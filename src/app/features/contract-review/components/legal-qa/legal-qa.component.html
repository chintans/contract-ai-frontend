<div class="p-6">
  <div class="max-w-4xl mx-auto">
    <div *ngIf="analysis$ | async as analysis; else loading">
      <div class="mb-6">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-semibold">Legal Q&A</h2>
          <p class="text-gray-600">{{ analysis.fileName }}</p>
        </div>
      </div>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Legal Q&A Assistant</mat-card-title>
          <mat-card-subtitle>Ask questions about your contract</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="h-[400px] overflow-y-auto mb-4 p-4">
            <div *ngFor="let message of messages" class="mb-4">
              <div [ngClass]="{
                'flex items-start': true,
                'justify-end': message.role === 'user',
                'justify-start': message.role === 'assistant'
              }">
                <div [ngClass]="{
                  'max-w-[70%] rounded-lg p-3': true,
                  'bg-blue-100': message.role === 'user',
                  'bg-gray-100': message.role === 'assistant'
                }">
                  <p class="text-sm">{{ message.content }}</p>
                  <p class="text-xs text-gray-500 mt-1">
                    {{ message.timestamp | date:'short' }}
                  </p>
                </div>
              </div>
            </div>
            <div *ngIf="isLoading" class="flex justify-center my-4">
              <mat-spinner diameter="30"></mat-spinner>
            </div>
          </div>
        </mat-card-content>
        <mat-divider></mat-divider>
        <div class="p-4">
          <form (ngSubmit)="sendMessage()" #qaForm="ngForm" class="flex gap-2">
            <mat-form-field appearance="outline" class="flex-grow">
              <mat-label>Ask a question</mat-label>
              <input matInput
                     aria-label="Ask a question"
                     [(ngModel)]="currentQuestion"
                     name="question"
                     placeholder="e.g., What are the key obligations?"
                     [disabled]="isLoading">
            </mat-form-field>
            <button mat-raised-button
                    color="primary"
                    type="submit"
                    [disabled]="!currentQuestion || isLoading">
              <mat-icon>send</mat-icon>
            </button>
          </form>
        </div>
      </mat-card>

      <mat-card class="mt-6">
        <mat-card-header>
          <mat-card-title>Suggested Questions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="grid grid-cols-2 gap-4 p-4">
            <button mat-stroked-button
                    *ngFor="let question of suggestedQuestions"
                    (click)="askSuggestedQuestion(question)"
                    [disabled]="isLoading">
              {{ question }}
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <ng-template #loading>
      <div class="text-center py-12">
        <mat-spinner diameter="48" class="mx-auto mb-4"></mat-spinner>
        <p class="text-gray-600">Loading contract data...</p>
      </div>
    </ng-template>
  </div>
</div> 